{
  "kind": "build_request",
  "title": "Fix Explorer client screen bug — navigation, layout, demo data, and FichePro access",
  "projectName": "NEXUS",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-49",
      "text": "In frontend/src/state/useAppState.ts, ensure: (1) the Screen union type includes 'explorer' as a valid value; (2) the initial GlobalState has clientTab defaulting to 'explorer'; (3) the go() action correctly navigates to 'explorer' — no logic should prevent this transition. Verify no field in initialState accidentally defaults to 'otp' or any screen other than 'login'.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "user-bug-report"
        ],
        "quotes": [
          "Dans useAppState.ts : Après OTP validé role client : go('explorer') OBLIGATOIRE, clientTab: 'explorer' par défaut, Vérifier que screen 'explorer' est bien dans le type Screen."
        ]
      },
      "acceptanceCriteria": [
        "The Screen type includes 'explorer' as a valid literal",
        "initialState.clientTab === 'explorer'",
        "initialState.screen === 'login'",
        "initialState.role === null",
        "go('explorer') sets state.screen to 'explorer' without errors"
      ]
    },
    {
      "id": "REQ-50",
      "text": "In frontend/src/App.tsx, verify and fix the renderScreen() switch statement so that case 'explorer' exists exactly as: case 'explorer': return <ExplorerScreen go={go} state={state} update={update} />. The string 'explorer' must be lowercase with no typos. No fallthrough. This case must be independent and always render ExplorerScreen when state.screen === 'explorer'.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "user-bug-report"
        ],
        "quotes": [
          "Dans App.tsx : Vérifier ce case existe et est exact : case 'explorer': return <ExplorerScreen go={go} state={state} update={update}/> Pas de typo. Pas de majuscule. 'explorer' en minuscule exact."
        ]
      },
      "acceptanceCriteria": [
        "Switch has an exact case 'explorer' (lowercase)",
        "ExplorerScreen receives go, state, and update props",
        "No fallthrough from or to adjacent cases",
        "Default case falls back to LoginScreen"
      ]
    },
    {
      "id": "REQ-51",
      "text": "Rewrite frontend/src/screens/client/ExplorerScreen.tsx with the following mandatory layout and behavior: (1) Root element: position relative (or fixed inset-0), display flex, flexDirection column, height 100%, overflow hidden. (2) Header: position absolute, top 0, left 0, right 0, height 56px, z-index 100 — shows NEXUS logo, role-switch pill ('Pro' with gold border, onClick → go('pro_dashboard') when role === 'client'), and notification bell. (3) Scroll zone: flex 1, overflowY auto, WebkitOverflowScrolling touch, paddingTop 72px — NO forced height, NO overflow hidden. (4) TabBarClient: flex-shrink 0, in natural flex flow, NEVER position fixed. (5) Visible content inside scroll zone: hero heading 'Find your expert' Inter 900 36px #F4F4F8; search bar 58px height with IconSearch; filter pills horizontal scroll (All / Flash / Barber / Coiffure / Esthetique / Massage) with active pill gold gradient background and text var(--void); pro cards in 'Available now' horizontal scroll (168x228px) and 'Experts for you' vertical list. (6) Every <img> tag must have onError={(e) => { e.currentTarget.style.display = 'none'; }} or a visible gradient fallback. (7) Empty state: if no pros match filters, display 'No experts available' Inter 500 14px #54546C centered. (8) Clicking a pro card calls update({ selectedPro: pro }) then go('fiche_pro'). (9) TabBarClient active tab = 'explorer'; tab onClick handlers: explorer → go('explorer'), reservations → go('client_reservations'), alertes → go('client_alertes'), profil → go('client_profil').",
      "target": "frontend",
      "source": {
        "messageIds": [
          "user-bug-report"
        ],
        "quotes": [
          "LAYOUT OBLIGATOIRE : position relative ou flex column flex 1 overflow hidden",
          "Header absolu top 0 z-100 : Logo NEXUS. + switch + notifs height 56px",
          "Scroll zone : flex 1 overflow-y auto -webkit-overflow-scrolling touch padding-top 72px PAS de height forcée PAS de overflow hidden",
          "Tab bar client : flex-shrink 0 JAMAIS position fixed Dans le flux flex naturel",
          "Si aucun pro : message visible 'Aucun expert disponible' Inter 500 14px #54546C"
        ]
      },
      "acceptanceCriteria": [
        "Root layout is flex column with overflow hidden",
        "Header is absolutely positioned at top with height 56px and z-index 100",
        "Scroll zone uses flex:1, overflowY:auto, paddingTop:72px, no forced height, no overflow:hidden",
        "TabBarClient is in natural flex flow, never position:fixed",
        "Hero heading 'Find your expert' is visible Inter 900 36px #F4F4F8",
        "Search bar is 58px tall and visible",
        "Filter pills are visible and horizontally scrollable",
        "Pro cards are visible with images and fallback",
        "All images have onError handler hiding broken images or showing gradient fallback",
        "Empty state 'No experts available' shows when no pros match",
        "Tapping a pro card navigates to fiche_pro",
        "TabBarClient active = 'explorer'",
        "All four tab onClick handlers navigate to the correct screens"
      ]
    },
    {
      "id": "REQ-52",
      "text": "In frontend/src/screens/client/ExplorerScreen.tsx, define a PROS_DEMO constant array with exactly 6 demo professional entries (always rendered as fallback when no canister data is available, replaced by real data when canister responds). The array must contain: { id:'1', prenom:'Alexandre', nom:'Studio Blade', categorie:'Barber', ville:'Geneve', note:4.9, nbAvis:127, prix:35, flash:true, reponsMin:8, image:'https://images.unsplash.com/photo-1503951914875-452162b0f3f1?w=400&h=500&fit=crop&q=80' }, { id:'2', prenom:'Karim', nom:'Karim Cuts', categorie:'Barber', ville:'Lausanne', note:4.8, nbAvis:89, prix:40, flash:true, reponsMin:12, image:'https://images.unsplash.com/photo-1599351431202-1e0f0137899a?w=400&h=500&fit=crop&q=80' }, { id:'3', prenom:'Elise', nom:'Elise Coiffure', categorie:'Coiffure', ville:'Geneve', note:4.9, nbAvis:203, prix:55, flash:false, reponsMin:25, image:'https://images.unsplash.com/photo-1562322140-8baeececf3df?w=400&h=500&fit=crop&q=80' }, { id:'4', prenom:'Nadia', nom:'Nadia Beauty', categorie:'Esthetique', ville:'Lausanne', note:4.7, nbAvis:156, prix:70, flash:true, reponsMin:5, image:'https://images.unsplash.com/photo-1570172619644-dfd03ed5d881?w=400&h=500&fit=crop&q=80' }, { id:'5', prenom:'Marco', nom:'Zen by Marco', categorie:'Massage', ville:'Berne', note:4.8, nbAvis:94, prix:80, flash:false, reponsMin:30, image:'https://images.unsplash.com/photo-1544161515-4ab6ce6db874?w=400&h=500&fit=crop&q=80' }, { id:'6', prenom:'Clara', nom:'Clara Nails', categorie:'Esthetique', ville:'Geneve', note:4.6, nbAvis:78, prix:40, flash:true, reponsMin:15, image:'https://images.unsplash.com/photo-1604654894610-df63bc536371?w=400&h=500&fit=crop&q=80' }. These demo entries are used as the initial value and whenever the canister returns an empty list or throws an error.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "user-bug-report"
        ],
        "quotes": [
          "Si canister non connecté : Afficher données de démonstration visibles avec vraies images Unsplash",
          "Ces données s'affichent toujours même si canister vide. Remplacées par données réelles quand canister répond."
        ]
      },
      "acceptanceCriteria": [
        "PROS_DEMO constant contains exactly 6 entries with the exact data specified",
        "All 6 Unsplash image URLs use the exact format with w=400&h=500&fit=crop&q=80",
        "Demo pros are rendered when canister returns empty list or is unavailable",
        "Demo pros are replaced by real data when canister responds with non-empty list",
        "All 6 cards are visible on screen with names, categories, ratings, and prices"
      ]
    },
    {
      "id": "REQ-53",
      "text": "In frontend/src/screens/client/FicheProScreen.tsx, add a guard at the top of the component: if state.selectedPro is null or undefined, immediately call go('explorer') and return null. FicheProScreen must never render when selectedPro is null. The component must read pro data from state.selectedPro and display it correctly. The back button in the header must call go('explorer').",
      "target": "frontend",
      "source": {
        "messageIds": [
          "user-bug-report"
        ],
        "quotes": [
          "FicheProScreen accessible : Tap sur card pro dans Explorer : update({ selectedPro: pro }) go('fiche_pro')",
          "FicheProScreen reçoit state.selectedPro Si null → go('explorer') auto"
        ]
      },
      "acceptanceCriteria": [
        "FicheProScreen returns null and calls go('explorer') when state.selectedPro is null",
        "FicheProScreen renders correctly when state.selectedPro is a valid object",
        "Header back button calls go('explorer')",
        "Pro name, category, cover image, services, and stats are rendered from state.selectedPro",
        "Cover image has onError gradient fallback",
        "Booking CTA calls go('booking_1')"
      ]
    }
  ],
  "constraints": [
    "Do not use position:fixed for TabBarClient — it must remain in natural flex flow",
    "Do not force a height on the scroll zone or set overflow:hidden on it",
    "All image elements must have onError handlers to hide broken images or show a gradient fallback",
    "Zero emoji throughout all modified files",
    "Zero Stripe, zero Revolut — TWINT only for payments",
    "Do not edit any file under frontend/src/hooks/ or frontend/src/components/ui/",
    "Navigation must use the go() function from useAppState only — no React Router"
  ],
  "nonGoals": [
    "Adding new screens not listed in the fix scope",
    "Modifying the backend Motoko actor",
    "Changing the payment flow or Payrexx integration",
    "Modifying OTPScreen beyond what is already fixed",
    "Adding new pro data fields beyond those in PROS_DEMO",
    "Implementing real canister data fetching for the Explorer (demo fallback is sufficient)"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}